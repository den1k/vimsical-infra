{
  "Version": "{{ ansible_date_time.date }}",
  "Statement": [
    {
      "Sid": "DynamoDB table access (storage access)",
      "Effect": "Allow",
      "Action": [
        "dynamodb:*"
      ],
      "Resource": "arn:aws:dynamodb:*:{{ aws_account_id }}:table/{{ ddb_table_name }}"
    },
    {
      "Sid": "S3 bucket access (log rotation)",
      "Effect": "Allow",
      "Action": [
        "s3:PutObject"
      ],
      "Resource": [
        "arn:aws:s3:::{{ ddb_s3_log_bucket }}",
        "arn:aws:s3:::{{ ddb_s3_log_bucket }}/*"
      ]
    },
    {
      "Sid": "CloudWatch Metrics",
      "Effect": "Allow",
      "Resource": "*",
      "Condition": {
        "Bool": {
          "aws:SecureTransport": "true"
        }
      },
      "Action": [
        "cloudwatch:PutMetricData",
        "cloudwatch:PutMetricDataBatch"
      ]
    }
  ]
}
