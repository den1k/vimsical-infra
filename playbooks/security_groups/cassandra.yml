---
# Cassandra sg
#

- name: create cassandra security group
  ec2_group:
    description: Cassandra cluster node security group
    name: "{{ cassandra_sg }}"
    region: "{{ aws_region }}"
    vpc_id: "{{ vpc.vpc_id }}"
    rules:
      # Inter-node
      - proto: tcp
        from_port: 7000
        to_port: 7000
        group_name: "{{ cassandra_sg }}"
      # Inter-node SSL
      - proto: tcp
        from_port: 7001
        to_port: 7001
        group_name: "{{ cassandra_sg }}"
      # CQL inter-node
      - proto: tcp
        from_port: 9042
        to_port: 9042
        group_name: "{{ cassandra_sg }}"
      # CQL clients
      - proto: tcp
        from_port: 9042
        to_port: 9042
        group_name: "{{ api_sg }}"

    rules_egress:
      - proto: all
        cidr_ip: 0.0.0.0/0
  tags: 
    - provision

# - name: destroy cassandra security group
#   ec2_group:
#     description: Cassandra cluster node security group
#     name: "{{ cassandra_sg }}"
#   tags: 
#     - destroy
